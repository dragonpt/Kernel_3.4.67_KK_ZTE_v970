#include <mach/mt_typedefs.h>

#define FGAUGE_VOLTAGE_FACTOR           2.44 // mV
#define FGAUGE_CURRENT_FACTOR           6.25 // uV/Rsns
#define FGAUGE_CURRENT_OFFSET_FACTOR    1.56 // uV/Rsns
#define FGAUGE_CAR_FACTOR               6.25 // uV/Rsns
#define FGAUGE_RSNS_FACTOR              0.02 // Ohm

//#define COMPASATE_OCV                   80 // mV for evb
#define COMPASATE_OCV                   40 // mV for phone

#define BATTERY_VOLTAGE_MINIMUM         3400
#define BATTERY_VOLTAGE_MAXIMUM         4200

#define BATTERY_CAPACITY_MAXIMUM        1600 // CM for ZTE v970

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

#define BATT_CAPACITY                   1600 // CM for ZTE v970

#define ENABLE_SW_COULOMB_COUNTER       0 // 1 is enable, 0 is disable
//#define ENABLE_SW_COULOMB_COUNTER     1 // 1 is enable, 0 is disable

//#define FG_CURRENT_OFFSET_DISCHARGING 	31
#define FG_CURRENT_OFFSET_DISCHARGING 	0

#define FG_RESISTANCE 	20

#define FG_METER_RESISTANCE 	0
//#define FG_METER_RESISTANCE 	540 // current meter

//#define MAX_BOOTING_TIME_FGCURRENT	5*6 // 5 seconds, 6 points = 1s
#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
//#define OCV_BOARD_COMPESATE	32 //mV 
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
//#define OCV_BOARD_COMPESATE	0 //mV 
//#define OCV_BOARD_COMPESATE	48 //mV 
//#define OCV_BOARD_COMPESATE	25 //mV 
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
//#define R_FG_BOARD_SLOPE	1057 //slope
//#define R_FG_BOARD_SLOPE	1075 //slope
#endif

#define Q_MAX_POS_50	1611
#define Q_MAX_POS_25	1600
#define Q_MAX_POS_0	1493
#define Q_MAX_NEG_10	1422

#define Q_MAX_POS_50_H_CURRENT	1585
#define Q_MAX_POS_25_H_CURRENT	1554
#define Q_MAX_POS_0_H_CURRENT	1349
#define Q_MAX_NEG_10_H_CURRENT	733

#define R_FG_VALUE 			20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG		100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			100 	//94 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
	{0  , 4032      },
	{3  , 4006      },
	{6  , 3978      },
	{9  , 3943      },
	{12 , 3918      },
	{16 , 3904      },
	{19 , 3892      },
	{22 , 3880      },
	{25 , 3865      },
	{28 , 3851      },
	{31 , 3838      },
	{34 , 3824      },
	{37 , 3813      },
	{41 , 3805      },
	{44 , 3798      },
	{47 , 3794      },
	{50 , 3791      },
	{53 , 3788      },
	{56 , 3786      },
	{59 , 3785      },
	{63  , 3783},         
	{66 , 3781      },
	{69 , 3778      },
	{72 , 3773      },
	{75 , 3765      },
	{77 , 3760      },
	{80 , 3753      },  
	{81 , 3748      }, 
	{83 , 3742      },
	{84 , 3735      },
	{86 , 3729      },  
	{87 , 3723      },
	{88 , 3718      },
	{89 , 3714      },
	{90 , 3711      },
	{90 , 3708      },
	{91 , 3706      },
	{92 , 3703      },
	{92 , 3704      },
	{93 , 3702      },
	{94 , 3701      },
	{94 , 3701      },
	{95 , 3700      },
	{95 , 3700      },
	{96 , 3699      },
	{96 , 3697      },
	{97 , 3698      },
        {97 , 3697      },
        {97 , 3697      },
        {98 , 3696      },
        {98 , 3695      },
        {99 , 3695      },
        {99 , 3694      },
        {99 , 3694      },
        {100, 3693      },
        {100, 3400}

};      
        
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
	{0   , 4162      },
	{2   , 4116      },
	{5   , 4076      },
	{7   , 4044      },
	{9   , 4012      },
	{11  , 3990      },
	{13  , 3976      },
	{16  , 3965      },
	{18  , 3955      },
	{20  , 3946      },
	{22  , 3936      },
	{25  , 3924      },
	{27  , 3913      },
	{29  , 3899      },
	{31  , 3882      },
	{34  , 3867},         
	{36  , 3853      },
	{38  , 3841      },
	{40  , 3830      },
	{43 , 3821},
	{45 , 3814},
	{47 , 3808},
	{49 , 3802},
	{52  , 3797      },
	{54  , 3792      },
	{56  , 3789      },
	{58  , 3785      },  
	{61  , 3783      }, 
	{63  , 3781},         
	{65  , 3779},         
	{67  , 3778},         
	{69  , 3775      },
	{72  , 3770      },
	{74  , 3765},         
	{76  , 3758      },
	{78  , 3750      },
	{81  , 3741      },
	{83  , 3728      },
	{85  , 3714      },
	{87  , 3703      },
	{90  , 3696      },
	{92  , 3692      },
	{94  , 3686      },
	{95  , 3680      },
	{96  , 3671      },
	{97  , 3654      },
	{98  , 3630      },
        {98  , 3605      },
        {99  , 3583      },
        {99  , 3565      },
        {99  , 3547      },
        {99  , 3531      },
        {100 , 3520      },
        {100 , 3509      },
        {100, 3499      },
        {100, 3400}
 
}; 

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
	{0   , 4179},         
	{2         , 4156  },
	{4   , 4136},         
	{6         , 4117  },
	{8         , 4099  },
	{10        , 4083  },
	{12        , 4071  },
	{14        , 4056  },
	{16        , 4032  },
	{18        , 4010  },
	{20        , 3994  },
	{22        , 3982  },
	{24        , 3972  },
	{26        , 3962  },
	{28        , 3949  },
	{30        , 3938  },
	{32        , 3927  },
	{34        , 3916  },
	{36        , 3906  },
	{38        , 3895  },
	{40        , 3883  },
	{42        , 3864  },
	{44        , 3845  },
	{46        , 3831  },
	{48        , 3822  },
	{50        , 3813  },
	{52        , 3808  },  
	{54        , 3801  }, 
	{56  , 3796},         
	{58  , 3791},         
	{60        , 3787  },  
	{62        , 3784  },
	{64        , 3780  },
	{66        , 3776  },
	{68  , 3774},         
	{70        , 3773  },
	{72        , 3771  },
	{74        , 3768  },
	{76        , 3763  },
	{78        , 3756  },
	{80        , 3748  },
	{82        , 3739  },
	{84        , 3723  },
	{86        , 3708  },
	{88        , 3691  },
	{90        , 3688  },
	{92        , 3687  },
        {94        , 3684  },
        {96        , 3672  },
        {98        , 3584  },
        {99       , 3421  },
        {100       , 3318  },
        {100       , 3291  },
        {100       , 3283  },
        {100       , 3277  },
        {100       , 3277  }
}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
	{0          , 4185},
	{2          , 4164},
	{4          , 4145},
	{6          , 4126},
	{8          , 4108},
	{10         , 4091},
	{12         , 4073},
	{14         , 4057},
	{16         , 4041},
	{18         , 4024},
	{20         , 4009},
	{22         , 3996},
	{24         , 3980},
	{26         , 3967},
	{28         , 3955},
	{30         , 3942},
	{32         , 3930},
	{34         , 3919},
	{36         , 3909},
	{38         , 3898},
	{40         , 3887},
	{42         , 3877},
	{44         , 3857},
	{46         , 3837},
	{48         , 3825},
	{50         , 3817},
	{51         , 3810},  
	{53         , 3804}, 
	{55         , 3798},
	{57         , 3792},
	{59         , 3788},  
	{61         , 3783},
	{63         , 3779},
	{65         , 3776},
	{67         , 3773},
	{69         , 3769},
	{71         , 3762},
	{73         , 3751},
	{75         , 3748},
	{77         , 3742},
	{79         , 3734},
	{81         , 3727},
	{83         , 3717},
	{85         , 3701},
	{87         , 3683},
	{89         , 3675},
	{91         , 3674},
        {93         , 3673},
        {95         , 3668},
        {97         , 3618},
        {99         , 3505},
        {100        , 3315},
        {100        , 3283},
        {100        , 3270},
        {100        , 3264},
        {100        , 3264}
};              

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0}
};    

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
	{848     , 4032      },
	{848     , 4006      },
	{878     , 3978      },
	{925     , 3943      },
	{1023    , 3918      },
	{1083    , 3904      },
	{1105    , 3892      },
	{1125    , 3880      },
	{1130    , 3865      },
	{1138    , 3851      },
	{1140    , 3838      },
	{1143    , 3824      },
	{1148    , 3813      },
	{1163    , 3805      },
	{1168    , 3798      },
	{1185    , 3794      },
	{1200    , 3791      },
	{1215    , 3788      },
	{1233    , 3786      },
	{1255    , 3785      },
	{1280    , 3783      },
	{1308    , 3781      },
	{1335    , 3778      },
	{1373    , 3773      },
	{1408    , 3765      },
	{1403    , 3760      },  
	{1385    , 3753      }, 
	{1370    , 3748      },
	{1358    , 3742      },
	{1340    , 3735      },  
	{1323    , 3729      },
	{1308    , 3723      },
	{1295    , 3718      },
	{1285    , 3714      },
	{1280    , 3711      },
	{1270    , 3708      },
	{1268    , 3706      },
	{1260    , 3703      },
	{1260    , 3704      },
	{1260    , 3702      },
	{1255    , 3701      },
	{1253    , 3701      },
	{1255    , 3700      },
	{1250    , 3700      },
	{1253    , 3699      },
	{1245    , 3697      },
        {1248    , 3698      },
        {1243    , 3697      },
        {1248    , 3697      },
        {1245    , 3696      },
        {1243    , 3695      },
        {1238    , 3695      },
        {1238    , 3694      },
        {1240    , 3694      },
        {1235    , 3693      },
        {505    ,  3400}
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
	{418     , 4162      },
	{418     , 4116      },
	{495     , 4076      },
	{518     , 4044      },
	{525     , 4012      },
	{540     , 3990      },
	{553     , 3976      },
	{573     , 3965      },
	{585     , 3955      },
	{598     , 3946      },
	{605     , 3936      },
	{613     , 3924      },
	{613     , 3913      },
	{608     , 3899      },
	{600     , 3882      },
	{593     , 3867      },
	{588     , 3853      },
	{590     , 3841      },
	{593     , 3830      },
	{600     , 3821      },
	{608     , 3814      },
	{618     , 3808      },
	{630     , 3802      },
	{640     , 3797      },
	{650     , 3792      },
	{668     , 3789      },  
	{675     , 3785      }, 
	{688     , 3783      },
	{695     , 3781      },
	{705     , 3779      },  
	{718     , 3778      },
	{725     , 3775      },
	{735     , 3770      },
	{748     , 3765      },
	{765     , 3758      },
	{785     , 3750      },
	{803     , 3741      },
	{823     , 3728      },
	{845     , 3714      },
	{888     , 3703      },
	{970     , 3696      },
	{1110    , 3692      },
	{1218    , 3686      },
	{1203    , 3680      },
	{1180    , 3671      },
	{1138    , 3654      },
        {1080    , 3630      },
        {1020    , 3605      },
        {963     , 3583      },
        {918     , 3565      },
        {870     , 3547      },
        {835     , 3531      },
	{808  , 3520},         
        {775     , 3509      },
        {755     , 3499      },
        {503     ,  3400     }
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
	{203     , 4179                                         },
	{203     , 4156                                         },
	{208     , 4136                                         },
	{210     , 4117                                         },
	{215     , 4099                                         },
	{223     , 4083                                         },
	{230     , 4071                                         },
	{235     , 4056                                         },
	{228     , 4032                                         },
	{230     , 4010                                         },
	{235     , 3994                                         },
	{243     , 3982                                         },
	{250     , 3972                                         },
	{255     , 3962                                         },
	{250     , 3949                                         },
	{260     , 3938                                         },
	{265     , 3927                                         },
	{270     , 3916                                         },
	{273     , 3906                                         },
	{273     , 3895                                         },
	{273     , 3883                                         },
	{248     , 3864                                         },
	{225     , 3845                                         },
	{213     , 3831                                         },
	{213     , 3822                                         },
	{208     , 3813                                         },  
	{215     , 3808                                         }, 
	{215     , 3801                                         },
	{218     , 3796                                         },
	{218     , 3791                                         },  
	{223     , 3787                                         },
	{230     , 3784                                         },
	{228     , 3780                                         },
	{230     , 3776                                         },
	{233     , 3774                                         },
	{238     , 3773                                         },
	{238  , 3771},         
	{238     , 3768                                         },
	{235     , 3763                                         },
	{233     , 3756                                         },
	{228  , 3748},         
	{230     , 3739                                         },
	{223     , 3723                                         },
	{230     , 3708                                         },
	{213     , 3691                                         },
	{223  , 3688},         
        {240     , 3687                                         },
        {258     , 3684                                         },
        {283     , 3672                                         },
        {265     , 3584                                         },
        {323     , 3421                                         },
        {300     , 3318                                         },
        {235     , 3291                                         },
        {208     , 3283                                         },
        {200     , 3277                                         },
        {195     , 3277            }
};

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
	{158     , 4185                                                                   },
	{158     , 4164                                                                   },
	{160     , 4145                                                                   },
	{160     , 4126                                                                   },
	{165     , 4108                                                                   },
	{168     , 4091                                                                   },
	{165     , 4073                                                                   },
	{168     , 4057                                                                   },
	{173     , 4041                                                                   },
	{173     , 4024                                                                   },
	{175     , 4009                                                                   },
	{180     , 3996                                                                   },
	{178     , 3980                                                                   },
	{183     , 3967                                                                   },
	{188     , 3955                                                                   },
	{188     , 3942                                                                   },
	{190     , 3930                                                                   },
	{195     , 3919                                                                   },
	{200     , 3909                                                                   },
	{208     , 3898                                                                   },
	{213     , 3887                                                                   },
	{218     , 3877                                                                   },
	{195     , 3857                                                                   },
	{170     , 3837                                                                   },
	{163     , 3825                                                                   },
	{163     , 3817                                                                   },  
	{165     , 3810                                                                   }, 
	{168     , 3804                                                                   },
	{170     , 3798                                                                   },
	{170     , 3792                                                                   },  
	{173     , 3788                                                                   },
	{178     , 3783                                                                   },
	{180     , 3779                                                                   },
	{185  , 3776},         
	{188     , 3773                                                                   },
	{188     , 3769                                                                   },
	{178     , 3762                                                                   },
	{163     , 3751                                                                   },
	{170     , 3748                                                                   },
	{170     , 3742                                                                   },
	{168     , 3734                                                                   },
	{170     , 3727                                                                   },
	{170     , 3717                                                                   },
	{168     , 3701                                                                   },
	{165     , 3683                                                                   },
	{160     , 3675                                                                   },
        {168     , 3674                                                                   },
        {183     , 3673                                                                   },
        {193     , 3668                                                                   },
        {183     , 3618                                                                   },
        {208     , 3505                                                                   },
        {290     , 3315                                                                   },
        {213     , 3283                                                                   },
	{180  , 3270},
        {165     , 3264                                                                   },
        {165     , 3264                                                                   }
};

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0}
};    


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

